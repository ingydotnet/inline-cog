#!/usr/bin/env perl

use strict;
use YAML::XS;
use JSON::XS;
use IO::All;

my $config_file = 'branch/build/config.yaml';
my $yaml_dir = 'tmp/yaml';
my $data = YAML::XS::LoadFile($config_file);
$data->{nodes} = [];

for my $node_id (@{$data->{node_order}}) {
    my $yaml_file = "$yaml_dir/$node_id.yaml";
    my $node = YAML::XS::LoadFile("$yaml_file");
    push @{$data->{nodes}}, $node;
}

print JSON::XS->new->canonical->pretty(1)->encode($data);
